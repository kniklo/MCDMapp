{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="top-section">
        <h1>Rate alternatives</h1>
    </div>
    <div class="bottom-section">
        {% for cr in cr_cr %}
            <div class="alternative_name">{{ cr.name }}</div>
            <table border="1" id="rate_table">
                {% for alt in all_alt %}
                    <tr data-id="{{ cr.id }}-{{ alt.id }}">
                        <td>{{ alt.name }}</td>
                        <td>
                            <select onchange="onSelectChange(event)" data-criterion-id="{{ cr.id }}" data-alternative-id="{{ alt.id }}">
                                {% set current_eval = ev_ev|selectattr('analysis_criterion_id', 'equalto', cr.id)|selectattr('analysis_alternative_id', 'equalto', alt.id)|first %}
                                {% for i in range(1, 11) %}
                                    <option value="{{ i }}" {% if current_eval and i == current_eval.subj_value %}selected{% endif %}>{{ i }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% endfor %}
    </div>
    <div class="buttons-container">
        <form action="{{ url_for('index') }}" method="post">
            <button type="submit">Back to main</button>
        </form>
        <form action="{{ url_for('analyze_task', task_id=task.id) }}" method="post">
            <button type="submit">Back to criteria comparision</button>
        </form>
        <form action="{{ url_for('results_page') }}" method="post">
            <button type="submit">Next</button>
        </form>
    </div>
</div>
<style>
    .alternative_name {
        background-color: #3498db;
        color: white;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        margin-bottom: 10px;
        padding: 8px;
    }
    #rate_table {
        width: 100%;
        margin-bottom: 20px;
        border-collapse: collapse;
    }
    #rate_table td {
        padding: 8px;
        border: 1px solid #ddd;
    }
    #rate_table select {
        width: 100%;
        padding: 5px;
    }
</style>
<script>
    function onSelectChange(event) {
        const select = event.target;
        const criterionId = select.dataset.criterionId;
        const alternativeId = select.dataset.alternativeId;
        const value = select.value;

        // Отправка данных на сервер
        fetch('/update_alternative_evaluation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                criterion_id: criterionId,
                alternative_id: alternativeId,
                value: value
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Evaluation updated successfully');
            } else {
                console.error('Failed to update evaluation');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>
{% endblock %}
{% block additional_content %}
{% endblock %}